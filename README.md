# 射频功率计项目 (RF Power Meter)

基于STM32F103的射频功率计，支持功率测量、驻波比计算、频率测量等功能。

## ? 项目概述

这是一个完整的射频功率计解决方案，具备以下特性：
- ? **频率测量**: 1Hz - 100MHz
- ? **功率测量**: 正向功率和反射功率检测
- ? **射频参数**: 自动计算VSWR、反射系数、传输效率
- ?? **TFT显示**: 1.77寸彩色屏幕，直观显示所有参数
- ?? **按键操作**: 3个按键实现完整的菜单导航
- ? **声音提示**: 蜂鸣器按键反馈和报警提示
- ?? **设置菜单**: 校准、标定、报警、亮度等设置

## ? 硬件配置

### 主控芯片
- **MCU**: STM32F103CBT6
- **时钟**: 72MHz
- **Flash**: 128KB
- **RAM**: 20KB

### 外设配置
| 功能 | 引脚 | 接口类型 | 说明 |
|------|------|----------|------|
| TFT显示屏 | SPI1 | 硬件SPI | 1.77寸 128x160 |
| 显示屏复位 | PB2 | GPIO | LCD_RESET |
| 显示屏命令/数据 | PB1 | GPIO | LCD_A0 |
| 背光控制 | PB0 | PWM | TIM3_CH3 |
| 正向功率检测 | PA2 | ADC | ADC1_IN2 |
| 反射功率检测 | PA3 | ADC | ADC1_IN3 |
| 频率计输入 | PA0 | TIM | TIM2_CH1 |
| 按键1(上/返回) | PB12 | GPIO | 上拉输入 |
| 按键2(确认) | PB13 | GPIO | 上拉输入 |
| 按键3(下/切换) | PB14 | GPIO | 上拉输入 |
| 蜂鸣器 | PB4 | GPIO | 输出控制 |
| Type-C通讯 | PA9/PA10 | UART | USART1 |
| EEPROM | PB10/PB11 | I2C | I2C2 |

### 定时器配置
- **TIM2**: 外部时钟模式，频率计数
- **TIM3**: PWM模式，背光控制
- **TIM4**: 1秒定时器，频率测量闸门

## ? 项目结构

```
project_1/
├── Core/                   # STM32 HAL库核心文件
│   ├── Inc/               # 头文件
│   └── Src/               # 源文件
├── Drivers/               # STM32 HAL驱动
├── MDK-ARM/              # Keil项目文件
├── my_core/              # 自定义功能模块
│   ├── ST7567A.c/h       # TFT屏驱动
│   ├── frequency_counter.c/h    # 频率计模块
│   ├── interface_manager.c/h    # 界面管理模块
│   ├── oledfont.c/h      # 字体文件
│   ├── 参考/             # 参考代码
│   └── 测试说明.md       # 测试文档
├── project_1.ioc         # STM32CubeMX配置文件
├── 开发手册.md           # 开发规范
├── 开发日志.md           # 开发进度
├── 项目介绍.md           # 详细需求说明
└── README.md             # 项目说明
```

## ? 快速开始

### 环境要求
- **IDE**: Keil MDK-ARM 5.x
- **配置工具**: STM32CubeMX
- **调试器**: J-Link 或 ST-Link
- **编译器**: ARM Compiler 6

### 编译步骤
1. 克隆项目到本地
```bash
git clone [你的仓库地址]
cd project_1
```

2. 用Keil MDK打开项目
```
打开 MDK-ARM/project_1.uvprojx
```

3. 编译项目
```
Project -> Build Target (F7)
```

4. 下载到硬件
```
Flash -> Download (F8)
```

## ? 功能特性

### 主界面显示
- **正向功率**: 实时显示，自动W/kW单位切换
- **反射功率**: 实时显示，自动W/kW单位切换  
- **驻波比(VSWR)**: 颜色警示显示
  - 绿色: ≤1.5 (良好)
  - 黄色: 1.5-2.0 (注意)
  - 红色: >2.0 (警告)
- **反射系数**: 精确到小数点后3位
- **传输效率**: 百分比显示
- **频率**: 自动Hz/KHz/MHz单位切换

### 设置菜单
- **校准功能**: 开路/短路/负载/功率校准
- **标定设置**: 功率斜率和零点调整
- **超限报警**: VSWR阈值设置和报警开关
- **显示亮度**: 10级背光亮度调节
- **关于设备**: 设备信息和规格显示

### 按键操作
- **PB12(↑)**: 返回上级菜单或主界面
- **PB13(OK)**: 确认选择或进入菜单
- **PB14(↓)**: 向下切换或参数调节
- **长按**: 特殊功能(预留)

## ? 技术参数

### 测量范围
- **频率范围**: 1Hz - 100MHz
- **功率范围**: 0.1W - 1kW (可扩展)
- **VSWR范围**: 1.0 - 10.0
- **测量精度**: ±5% (校准后)

### 显示参数
- **屏幕**: 1.77寸 TFT，128×160像素
- **颜色**: 65K色彩显示
- **刷新率**: 10Hz
- **背光**: PWM调光，10级亮度

### 电源参数
- **供电**: Type-C 5V
- **功耗**: <500mA
- **待机**: <50mA

## ? 开发说明

### 代码规范
1. CubeMX生成的文件，所有代码必须在`USER CODE BEGIN/END`区块内
2. 引用头文件直接使用文件名，不加路径
3. 新增代码文件必须放在`my_core`文件夹内
4. 每次修改代码前需要确认
5. 使用中文注释

### 模块说明
- **frequency_counter**: 频率计功能模块
- **interface_manager**: 界面管理和按键处理
- **ST7567A**: TFT屏幕驱动
- **oledfont**: 字体数据

### 版本控制
- 使用Git进行版本控制
- 主要功能完成后打tag
- 重要修改前先提交当前版本

## ? 测试指南

详细测试步骤请参考: [测试说明.md](my_core/测试说明.md)

### 基本测试
1. 编译下载测试
2. 启动流程测试
3. 界面显示测试
4. 按键功能测试

### 功能测试
1. 频率计测试
2. ADC功率测试
3. 射频参数计算测试
4. 报警功能测试

## ? 开发日志

- [x] 硬件资源初始化
- [x] TFT屏程序移植
- [x] 频率计功能实现
- [x] 界面管理系统
- [x] 按键处理和菜单
- [ ] ADC校准功能
- [ ] 数据存储功能
- [ ] 上位机通讯
- [ ] 完整测试验证

## ? 贡献指南

1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开 Pull Request

## ? 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

## ? 联系方式

- 项目维护者: [你的名字]
- 邮箱: [你的邮箱]
- 项目链接: [GitHub仓库地址]

## ? 致谢

感谢所有为这个项目做出贡献的开发者和测试人员。
