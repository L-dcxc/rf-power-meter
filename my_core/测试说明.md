# 射频功率计系统测试说明

## ? 已完成的集成

### ? 修改的文件：
1. **Core/Src/main.c** - 主程序文件
2. **Core/Src/stm32f1xx_it.c** - 中断处理文件

### ? 新增的文件：
1. **my_core/frequency_counter.h** - 频率计头文件
2. **my_core/frequency_counter.c** - 频率计实现文件
3. **my_core/interface_manager.h** - 界面管理头文件
4. **my_core/interface_manager.c** - 界面管理实现文件
5. **my_core/interface_integration_example.c** - 集成示例文件

## ? 系统功能

### ? 界面系统：
- **主界面**：显示所有射频参数
- **设置菜单**：5个菜单项可选择
- **按键操作**：PB12(返回)、PB13(确认)、PB14(切换)
- **颜色警示**：VSWR根据数值显示不同颜色

### ? 测量功能：
- **频率测量**：1Hz-100MHz，自动单位切换
- **功率测量**：正向/反射功率，自动W/kW单位
- **射频参数**：VSWR、反射系数、传输效率自动计算
- **报警功能**：VSWR超限蜂鸣器报警

## ? 测试步骤

### 1. 编译和下载
```
1. 在Keil MDK中打开项目
2. 编译项目 (Build -> Build Target)
3. 下载到STM32 (Flash -> Download)
4. 复位运行
```

### 2. 基本功能测试

#### 启动测试：
- [ ] 上电后显示"射频功率计"和"启动中..."
- [ ] 显示"系统启动成功"和"进入主界面"
- [ ] 进入主界面显示

#### 主界面测试：
- [ ] 显示"射频功率计"标题
- [ ] 显示正向功率、反射功率区域
- [ ] 显示驻波比、反射系数区域  
- [ ] 显示传输效率、频率区域
- [ ] 初始状态显示"-- W"、"--"等占位符

#### 按键测试：
- [ ] 按PB13(OK键)进入设置菜单
- [ ] 在菜单中按PB14(下键)切换菜单项
- [ ] 按PB12(上键)返回主界面
- [ ] 按键有蜂鸣器反馈音

#### 菜单系统测试：
- [ ] 菜单显示5个选项：校准功能、标定设置、超限报警、显示亮度、关于设备
- [ ] 光标高亮显示当前选项
- [ ] 按OK键进入子菜单
- [ ] 各子菜单显示相应内容

### 3. 频率计测试

#### 无信号测试：
- [ ] PA0无信号输入时，频率显示"-- Hz"

#### 信号发生器测试：
```
1. 连接信号发生器到PA0
2. 设置不同频率测试：
   - 1KHz -> 显示"1.00 KHz"
   - 10KHz -> 显示"10.0 KHz" 
   - 100KHz -> 显示"100 KHz"
   - 1MHz -> 显示"1.00 MHz"
   - 10MHz -> 显示"10.0 MHz"
```

### 4. 功率测试

#### ADC测试：
```
1. 在PA2施加0-3.3V电压
2. 观察正向功率显示变化
3. 在PA3施加0-3.3V电压  
4. 观察反射功率显示变化
```

#### 射频参数计算测试：
```
1. 设置正向功率 > 反射功率
2. 观察VSWR计算结果
3. 观察反射系数计算结果
4. 观察传输效率计算结果
5. 测试VSWR颜色警示：
   - VSWR ≤ 1.5 -> 绿色
   - 1.5 < VSWR ≤ 2.0 -> 黄色  
   - VSWR > 2.0 -> 红色
```

### 5. 报警测试

#### VSWR报警测试：
```
1. 进入"超限报警"菜单
2. 确认报警使能状态
3. 确认VSWR阈值设置
4. 制造VSWR > 阈值的条件
5. 观察蜂鸣器是否报警
```

### 6. 背光测试

#### 亮度调节测试：
```
1. 进入"显示亮度"菜单
2. 观察当前亮度显示
3. 观察亮度条显示
4. 按下键调节亮度
5. 观察背光亮度变化
```

## ? 常见问题排查

### 编译错误：
- 检查头文件路径是否正确
- 检查my_core文件夹是否在包含路径中

### 显示异常：
- 检查SPI1连接是否正常
- 检查LCD初始化是否成功

### 频率计无读数：
- 检查PA0连接是否正常
- 检查TIM2和TIM4配置是否正确
- 检查中断是否正常触发

### 按键无响应：
- 检查PB12、PB13、PB14引脚配置
- 检查按键防抖是否正常

### ADC读数异常：
- 检查PA2、PA3引脚配置
- 检查ADC初始化是否正确
- 检查参考电压是否为3.3V

## ? 调试建议

### 1. 串口调试：
```c
// 在main.c中添加调试输出
printf("频率: %lu Hz\r\n", FreqCounter_GetFrequencyHz());
printf("正向功率: %.2f W\r\n", g_power_result.forward_power);
printf("VSWR: %.2f\r\n", g_rf_params.vswr);
```

### 2. LED指示：
```c
// 在主循环中添加LED闪烁指示系统运行
static uint32_t led_time = 0;
if (HAL_GetTick() - led_time > 1000) {
    led_time = HAL_GetTick();
    HAL_GPIO_TogglePin(GPIOB, GPIO_PIN_4);  // 蜂鸣器引脚作为LED
}
```

### 3. 断点调试：
- 在FreqCounter_TIM4_Callback函数设置断点
- 在InterfaceManager_Process函数设置断点
- 在按键处理函数设置断点

## ? 下一步开发

### 功能扩展：
1. 添加数据存储功能(EEPROM)
2. 添加上位机通讯功能(UART)
3. 添加校准功能实现
4. 添加更多测量参数
5. 优化界面显示效果

### 性能优化：
1. 优化ADC采样精度
2. 优化频率测量精度
3. 添加数字滤波算法
4. 优化界面刷新效率

## ? 测试完成标准

- [ ] 所有基本功能正常
- [ ] 频率测量准确
- [ ] 功率测量稳定
- [ ] 界面操作流畅
- [ ] 按键响应正常
- [ ] 报警功能正常
- [ ] 无明显bug或异常
